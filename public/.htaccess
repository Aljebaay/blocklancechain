RewriteEngine On
Options -Indexes

<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "*"
</IfModule>

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.+\.(?:css|js|map|png|jpe?g|gif|svg|ico|woff2?|ttf|eot|webp|mp4|webm|pdf|json|mp3|wav|ogg))$ asset_proxy.php?path=$1 [QSA,L,NC]

# categories
RewriteRule ^categories/(.+)/(.+)/?$ categories/category.php?cat_url=$1&cat_child_url=$2 [QSA,L,NC]
RewriteRule ^categories/([\S\s/+.]+)/?$ categories/category.php?cat_url=$1 [QSA,L,NC]

# proposals
RewriteRule ^proposals/(proposal_files|ajax|sections|coupons)($|/) - [L,NC]
RewriteRule ^proposals/(.*)/([\s\S]+)$ proposals/proposal.php?username=$1&proposal_url=$2 [QSA,L,NC]

# blog
RewriteRule ^blog/([0-9]+)/([\S\s/+.]+)/?$ blog/post.php?id=$1 [QSA,L,NC]

# article
RewriteRule ^article/(article_images)($|/) - [L,NC]
RewriteRule ^article/([\S\s]+)/?$ article/article.php?article_url=$1 [QSA,L,NC]

# tags
RewriteRule ^tags/([\s\S]+)$ tags/tag.php?tag=$1&%{QUERY_STRING} [L,NC]

# pages
RewriteRule ^pages/([\S\s]+)/?$ pages/index.php?slug=$1 [QSA,L,NC]

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]

RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
RewriteRule ^ %1 [R,L]

RewriteRule ^([0-9a-zA-Z-_-]+)$ handler.php?slug=$1 [QSA,L]

RewriteCond %{HTTP_HOST} !=localhost
RewriteCond %{HTTP_HOST} !^www\.
RewriteRule (.*) https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

RewriteCond %{HTTPS} off
RewriteCond %{HTTP_HOST} !=localhost
RewriteCond %{HTTP_HOST} ^www\.
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
